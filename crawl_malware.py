import requests
import re

def get_one_page(url):
	try:
		response = requests.get(url)
		if response.status_code == 200:
			return response.text
		return None
	except RequestException:
		return None

def parse_one_page(html, page):
	pattern = re.compile('<tr>.*?<a href="./(.*?)">.*?<img src.*?</tr>', re.S)
	items = re.findall(pattern, html)
	count = 0
	for item in items:
		url2 = 'http://malwaredb.malekal.com/' + item
		response2 = requests.get(url2)
		name = 'malware/' + item[15:] + '.zip'
		with open(name,'wb') as f:
			f.write(response2.content)
			count += 1
			print('complete : ' + str(page) + '-' + str(count))  
			f.close()

def main(page):
	url = 'http://malwaredb.malekal.com/index.php?page=' + str(page)
	html = get_one_page(url)
	parse_one_page(html, page)
	
if __name__ == '__main__':
	for i in range(827):
		main(i+1)
